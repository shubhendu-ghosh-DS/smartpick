<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header class="brand-header">
        <h1 class="logo">Smart<span class="highlight">Pick</span></h1>
    </header>
    <h1>Product Details</h1>

    <button id="home-button">Go to Home</button>

    <div id="product-detail" class="card" style="margin-bottom: 30px;"></div>

    <h2>Recommended Products</h2>
    <div id="recommendation-container" class="card-grid"></div>

    <script>
        const homeButton = document.getElementById('home-button');
        homeButton.addEventListener('click', () => {
            window.location.href = '/';
        });

        async function loadProductAndRecommendations(productId, appliance) {
            if (!productId || !appliance) return;

            const apiUrl = `https://shubhendu-ghosh-pickengine.hf.space/recommend/${appliance}/${productId}`;
            const response = await fetch(apiUrl);
            const data = await response.json();

            const product = data.product;
            const recommendations = data.recommendations;

            const productDiv = document.getElementById('product-detail');
            productDiv.innerHTML = `
                <img src="${product.image}" alt="${product.name}" />
                <h3>${product.name}</h3>
                <p><strong>Brand:</strong> ${product.brand}</p>
                <p><strong>Price:</strong> ₹${product.actual_price}</p>
                <p><strong>Rating:</strong> ⭐ ${product.ratings ? product.ratings + ' out of 5' : 'N/A'}</p>
            `;

            const recContainer = document.getElementById('recommendation-container');
            recContainer.innerHTML = '';
            recommendations.forEach(rec => {
                const recDiv = document.createElement('div');
                recDiv.className = 'card';
                recDiv.innerHTML = `
                    <img src="${rec.image}" alt="${rec.name}" />
                    <p>${rec.name}</p>
                    <p>₹${rec.actual_price}</p>
                    <p>⭐ ${rec.ratings ? rec.ratings + ' out of 5' : 'N/A'}</p>
                `;
                recDiv.addEventListener('click', () => {
                    const redirectUrl = `/product?product_id=${rec._id}&appliance=${appliance}`;
                    window.location.href = redirectUrl;
                });
                recContainer.appendChild(recDiv);
            });
        }

        const initialProductId = "{{ product_id }}";
        const appliance = "{{ appliance }}";

        window.onload = () => {
            loadProductAndRecommendations(initialProductId, appliance);
        };
    </script>
</body>
</html>
